<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Neon Contact</title>

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>
<path fill='%23ffffff' d='M17.342 0a3.674 3.674 0 0 0-3.647 3.674a3.673 3.673 0 0 0 3.673 3.673A3.674 3.674 0 1 0 17.342 0zM4.623.16a2.746 2.746 0 0 0-2.747 2.747v18.167a2.747 2.747 0 1 0 5.494 0V2.907A2.749 2.749 0 0 0 4.623.16zm6.95 7.208a2.729 2.729 0 0 0-2.237 4.294l7.81 11.155a2.729 2.729 0 1 0 4.471-3.131L13.807 8.53a2.729 2.729 0 0 0-2.234-1.163z'/>
</svg>">

    <style>
        :root {
            --bg-color: #05050a;
            --text-color: #ffffff;
            --accent-color: #00bfff;
            --header-bg: rgba(255, 255, 255, 0.05);
            --content-bg: rgba(255, 255, 255, 0.03);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --glow-color: rgba(0, 191, 255, 0.3);
            --msg-you: rgba(0, 180, 255, 0.18);
            --msg-other: rgba(120, 120, 140, 0.15);
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family:Inter, sans-serif; }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Matrix background (exactly like your Library) */
        .jp-matrix {
            background-color: var(--bg-color);
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            grid-auto-rows: 40px;
            font-size: 32px;
            color: rgba(0, 150, 255, 0.4);
            font-family: "Courier New", Courier, monospace;
            justify-content: center;
            align-content: center;
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            user-select: none;
        }
        .jp-matrix > span {
            text-align: center;
            text-shadow: 0 0 5px rgba(0, 150, 255, 0.5);
            transition: color 0.5s, text-shadow 0.5s;
            line-height: 1;
        }
        @keyframes smooth-pulse {
            0%, 100% { color: rgba(0,150,255,0.4); text-shadow: 0 0 5px rgba(0,150,255,0.5); }
            30% { color: rgba(100,200,255,1); text-shadow: 0 0 10px rgba(100,200,255,1), 0 0 15px rgba(100,200,255,1); }
            50% { color: rgba(255,105,180,1); text-shadow: 0 0 10px rgba(255,105,180,1), 0 0 15px rgba(255,105,180,1); }
            70% { color: #ffffff; text-shadow: 0 0 10px #fff, 0 0 15px #fff, 0 0 20px #fff; }
        }
        .jp-matrix > span:nth-child(19n+2) { animation: smooth-pulse 3.5s ease-in-out infinite 0.2s; }
        .jp-matrix > span:nth-child(29n+1) { animation: smooth-pulse 4.1s ease-in-out infinite 0.7s; }
        .jp-matrix > span:nth-child(11n) { animation: smooth-pulse 2.9s ease-in-out infinite 1.1s; color: rgba(100,200,255,0.7); }
        /* (more pulse classes omitted for brevity - same as original) */

        /* AUTH MODAL - floating glass card */
        .auth-modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(5,5,10,0.85);
            backdrop-filter: blur(12px);
            z-index: 100;
        }
        .auth-card {
            background: var(--content-bg);
            border-radius: 20px;
            padding: 40px 50px;
            width: 380px;
            box-shadow: 0 20px 40px var(--shadow-color);
            border: 1px solid rgba(255,255,255,0.08);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .auth-card h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--accent-color);
        }
        .auth-card p.subtitle {
            opacity: 0.7;
            margin-bottom: 30px;
        }

        /* Uiverse input style - EXACTLY as you gave */
        .input {
            border: none;
            outline: none;
            border-radius: 15px;
            padding: 1em;
            background-color: #ccc;
            box-shadow: inset 2px 5px 10px rgba(0,0,0,0.3);
            transition: 300ms ease-in-out;
            width: 100%;
            font-size: 1.1rem;
            margin-bottom: 16px;
            color: #222;
        }
        .input:focus {
            background-color: white;
            transform: scale(1.05);
            box-shadow: 13px 13px 100px #969696,
                        -13px -13px 100px #ffffff;
        }

        .auth-card button {
            background: var(--accent-color);
            color: #000;
            border: none;
            padding: 14px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        .auth-card button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .toggle-link {
            margin-top: 20px;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 0.95rem;
            text-decoration: underline;
        }
        .toggle-link:hover { color: #fff; }

        /* Chat view */
        header {
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            padding: 14px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 10;
        }
        header h1 { font-size: 1.5rem; font-weight: 600; letter-spacing: 1px; }
        .logout-btn {
            background: rgba(255,80,80,0.2);
            color: #ff5050;
            border: 1px solid #ff5050;
            padding: 8px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-width: 860px;
            margin: 0 auto;
            width: 100%;
        }

        .message {
            max-width: 78%;
            padding: 12px 16px;
            border-radius: 14px;
            position: relative;
            word-wrap: break-word;
            backdrop-filter: blur(6px);
        }
        .message.you { align-self: flex-end; background: var(--msg-you); border: 1px solid rgba(0,180,255,0.25); }
        .message.other { align-self: flex-start; background: var(--msg-other); border: 1px solid rgba(255,255,255,0.08); }

        .message .sender {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 4px;
        }
        .message img { max-width:100%; border-radius:10px; margin-top:8px; }
        .message audio { margin-top:8px; width:100%; max-width:320px; }
        .message.file { background: rgba(120,120,140,0.2); display:flex; align-items:center; gap:12px; }

        .input-area {
            background: var(--header-bg);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255,255,255,0.08);
            padding: 16px 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            z-index: 10;
        }
        #message-input {
            flex:1;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius:12px;
            padding:12px 16px;
            color:white;
            font-size:1rem;
        }
        .btn {
            background: rgba(0,191,255,0.18);
            border:1px solid var(--accent-color);
            color:var(--accent-color);
            border-radius:10px;
            padding:10px 16px;
            cursor:pointer;
            transition:all 0.25s;
        }
        .btn:hover { background:rgba(0,191,255,0.35); transform:translateY(-1px); }

        .btn.record { background:rgba(255,80,120,0.18); border-color:#ff5078; color:#ff5078; }
        .btn.record.recording { background:rgba(255,80,120,0.45); animation:pulse 1.4s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }

        .hidden { display:none !important; }
    </style>
</head>
<body>

<div class="jp-matrix">
    <!-- Same huge katakana list as your original Library page -->
    <span>„Ç¢</span><span>„Ç§</span><span>„Ç¶</span><span>„Ç®</span><span>„Ç™</span><span>„Ç´</span><span>„Ç≠</span><span>„ÇØ</span><span>„Ç±</span><span>„Ç≥</span><span>„Çµ</span><span>„Ç∑</span><span>„Çπ</span><span>„Çª</span><span>„ÇΩ</span><span>„Çø</span><span>„ÉÅ</span><span>„ÉÑ</span><span>„ÉÜ</span><span>„Éà</span><span>„Éä</span><span>„Éã</span><span>„Éå</span><span>„Éç</span><span>„Éé</span><span>„Éè</span><span>„Éí</span><span>„Éï</span><span>„Éò</span><span>„Éõ</span><span>„Éû</span><span>„Éü</span><span>„É†</span><span>„É°</span><span>„É¢</span><span>„É§</span><span>„É¶</span><span>„É®</span><span>„É©</span><span>„É™</span><span>„É´</span><span>„É¨</span><span>„É≠</span><span>„ÉØ</span><span>„É≤</span><span>„É≥</span><span>„Ç¨</span><span>„ÇÆ</span><span>„Ç∞</span><span>„Ç≤</span><span>„Ç¥</span><span>„Ç∂</span><span>„Ç∏</span><span>„Ç∫</span><span>„Çº</span><span>„Çæ</span><span>„ÉÄ</span><span>„ÉÇ</span><span>„ÉÖ</span><span>„Éá</span><span>„Éâ</span><span>„Éê</span><span>„Éì</span><span>„Éñ</span><span>„Éô</span><span>„Éú</span><span>„Éë</span><span>„Éî</span><span>„Éó</span><span>„Éö</span><span>„Éù</span><!-- repeated blocks to fill grid -->
</div>

<!-- AUTH MODAL -->
<div id="auth-modal" class="auth-modal">
    <div class="auth-card" id="auth-card">
        <h2 id="auth-title">Create An Account</h2>
        <p class="subtitle" id="auth-subtitle">Join the Neon Contact group</p>

        <input type="text" id="username-input" class="input" placeholder="Username" autocomplete="off">
        <input type="password" id="password-input" class="input" placeholder="Password">

        <button id="auth-submit">Create Account</button>

        <div class="toggle-link" id="toggle-link">Already have an account? Log in</div>
    </div>
</div>

<!-- CHAT VIEW -->
<header id="chat-header" class="hidden">
    <h1>Neon Contact</h1>
    <div style="display:flex; align-items:center; gap:16px;">
        <span id="current-username" style="opacity:0.8; font-weight:500;"></span>
        <button class="logout-btn" id="logout-btn">Log out</button>
    </div>
</header>

<div id="chat-view" class="hidden" style="flex:1; display:flex; flex-direction:column;">
    <div class="chat-container" id="chat"></div>

    <div class="input-area">
        <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off"/>
        
        <label class="btn" title="Send image">
            <input type="file" id="image-input" accept="image/*" hidden/> üì∑
        </label>
        
        <label class="btn" title="Send file">
            <input type="file" id="file-input" hidden/> üìé
        </label>
        
        <button class="btn record" id="record-btn" title="Record voice">üéôÔ∏è</button>
        
        <button class="btn" id="send-btn">Send</button>
    </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// LocalStorage keys
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORAGE_USER = 'neonUser';
const STORAGE_MESSAGES = 'neonMessages';

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Fake initial messages (group chat feel)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getInitialMessages() {
    return [
        {id:1, sender:"karas", content:"yo what's good everyone", type:"text", time:"14:22"},
        {id:2, sender:"voidwalker", content:"just hit 1000 on the new track üî•", type:"text", time:"14:25"},
        {id:3, sender:"neonghost", content:"anyone got the new cyberpunk 2077 patch?", type:"text", time:"14:27"},
        {id:4, sender:"karas", content:"here's a quick vibe", type:"image", content:"https://picsum.photos/id/1015/600/400", time:"14:28"}
    ];
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// State
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentUser = null;
let messages = JSON.parse(localStorage.getItem(STORAGE_MESSAGES)) || getInitialMessages();

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Render chat
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const chatContainer = document.getElementById('chat');

function renderMessages() {
    chatContainer.innerHTML = '';
    messages.forEach(msg => {
        const div = document.createElement('div');
        div.classList.add('message', msg.sender === currentUser.username ? 'you' : 'other');

        const senderEl = document.createElement('div');
        senderEl.className = 'sender';
        senderEl.textContent = msg.sender;
        div.appendChild(senderEl);

        if (msg.type === 'text') {
            const text = document.createElement('div');
            text.textContent = msg.content;
            div.appendChild(text);
        } else if (msg.type === 'image') {
            const img = document.createElement('img');
            img.src = msg.content;
            div.appendChild(img);
        } else if (msg.type === 'audio') {
            const audio = document.createElement('audio');
            audio.controls = true;
            audio.src = msg.content;
            div.appendChild(audio);
        } else if (msg.type === 'file') {
            div.classList.add('file');
            div.innerHTML += `
                <span style="font-size:1.6rem;">üìÑ</span>
                <div>
                    <div style="font-weight:500;">${msg.content.name}</div>
                    <small>${(msg.content.size/1024).toFixed(1)} KB</small>
                </div>
            `;
        }

        const time = document.createElement('time');
        time.style.fontSize = '0.7rem';
        time.style.opacity = '0.6';
        time.style.marginTop = '6px';
        time.style.display = 'block';
        time.style.textAlign = msg.sender === currentUser.username ? 'right' : 'left';
        time.textContent = msg.time;
        div.appendChild(time);

        chatContainer.appendChild(div);
    });
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Add message
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addMessage(content, type = 'text') {
    const msg = {
        id: Date.now(),
        sender: currentUser.username,
        content,
        type,
        time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
    };
    messages.push(msg);
    localStorage.setItem(STORAGE_MESSAGES, JSON.stringify(messages));
    renderMessages();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Auth logic
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const authModal = document.getElementById('auth-modal');
const authCard = document.getElementById('auth-card');
const authTitle = document.getElementById('auth-title');
const authSubtitle = document.getElementById('auth-subtitle');
const usernameInput = document.getElementById('username-input');
const passwordInput = document.getElementById('password-input');
const authSubmit = document.getElementById('auth-submit');
const toggleLink = document.getElementById('toggle-link');

let isLoginMode = false;

function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    if (isLoginMode) {
        authTitle.textContent = 'Log In';
        authSubtitle.textContent = 'Welcome back to the grid';
        authSubmit.textContent = 'Log In';
        toggleLink.textContent = "Don't have an account? Create one";
    } else {
        authTitle.textContent = 'Create An Account';
        authSubtitle.textContent = 'Join the Neon Contact group';
        authSubmit.textContent = 'Create Account';
        toggleLink.textContent = 'Already have an account? Log in';
    }
    usernameInput.value = '';
    passwordInput.value = '';
}

toggleLink.addEventListener('click', toggleAuthMode);

authSubmit.addEventListener('click', () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    if (!username || !password) {
        alert('Username and password required');
        return;
    }

    let users = JSON.parse(localStorage.getItem('neonUsers')) || {};

    if (isLoginMode) {
        // Login
        if (users[username] && users[username] === password) {
            currentUser = {username};
            localStorage.setItem(STORAGE_USER, JSON.stringify(currentUser));
            enterChat();
        } else {
            alert('Wrong username or password');
        }
    } else {
        // Create account
        if (users[username]) {
            alert('Username already taken');
        } else {
            users[username] = password;
            localStorage.setItem('neonUsers', JSON.stringify(users));
            currentUser = {username};
            localStorage.setItem(STORAGE_USER, JSON.stringify(currentUser));
            enterChat();
        }
    }
});

// Enter chat
function enterChat() {
    authModal.classList.add('hidden');
    document.getElementById('chat-header').classList.remove('hidden');
    document.getElementById('chat-view').classList.remove('hidden');
    document.getElementById('current-username').textContent = `@${currentUser.username}`;
    renderMessages();
}

// Log out
document.getElementById('logout-btn').addEventListener('click', () => {
    localStorage.removeItem(STORAGE_USER);
    currentUser = null;
    document.getElementById('chat-header').classList.add('hidden');
    document.getElementById('chat-view').classList.add('hidden');
    authModal.classList.remove('hidden');
    toggleAuthMode(); // reset to create mode
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Chat input handlers (same as previous version)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const messageInput = document.getElementById('message-input');
const sendBtn = document.getElementById('send-btn');
const imageInput = document.getElementById('image-input');
const fileInput = document.getElementById('file-input');
const recordBtn = document.getElementById('record-btn');

let mediaRecorder, audioChunks = [], isRecording = false;

// Text send
function sendText() {
    const text = messageInput.value.trim();
    if (!text) return;
    addMessage(text, 'text');
    messageInput.value = '';
}
sendBtn.addEventListener('click', sendText);
messageInput.addEventListener('keypress', e => { if (e.key === 'Enter') sendText(); });

// Image
imageInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => addMessage(ev.target.result, 'image');
    reader.readAsDataURL(file);
});

// File
fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    addMessage(file, 'file');
});

// Voice
recordBtn.addEventListener('click', async () => {
    if (!isRecording) {
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = ev => audioChunks.push(ev.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(audioChunks, {type:'audio/webm'});
            const url = URL.createObjectURL(blob);
            addMessage(url, 'audio');
            stream.getTracks().forEach(t => t.stop());
        };
        mediaRecorder.start();
        recordBtn.classList.add('recording');
        recordBtn.textContent = '‚èπÔ∏è';
        isRecording = true;
    } else {
        if (mediaRecorder) mediaRecorder.stop();
        recordBtn.classList.remove('recording');
        recordBtn.textContent = 'üéôÔ∏è';
        isRecording = false;
    }
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Init
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.onload = () => {
    const savedUser = localStorage.getItem(STORAGE_USER);
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        enterChat();
    } else {
        authModal.classList.remove('hidden');
    }
};
</script>
</body>
</html>
